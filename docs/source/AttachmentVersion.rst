Форматы документов
==================

Формат, утвержденный Приказом ФНС России от `24.03.2016 №ММВ-7-15/155@ <https://normativ.kontur.ru/document?moduleId=1&documentId=271958>`__ позволяет сформировать 3 разных типа документов:

- *счета-фактуры*,

- *накладные, акты, другие первичные документы*,

- *УПД*.

В XML-файле документа необходимо заполнить поле «функция», которая определит тип документа:

- *счет-фактура* (**СЧФ**),

- *первичный документ* (**ДОП**),

- *УПД* (**СЧФДОП**).


Работа в Диадоке
----------------

Для Диадока документ в 155 формате – это контейнер, внутри которого лежит информация о сделке, совершенной клиентом.

Диадок ничего не знает о том, как выглядит учетная политика клиентов, и, соответственно, не может угадать дали ему *ЭСФ/АКТ/Накладную/УПД*.

Более того, по содержанию документа так же нельзя однозначно отличить один тип документа от другого.

.. note::
    При отправке документа участник ЭДО всегда сам выбирает показатель «тип документа».

Пример
------

Если продавец выставит счет-фактуру по формату согласно Приказу №155, укажет в документе функцию СЧФ, но «тип документа» в API укажет UniversalTransferDocument, то Диадок визуализирует документ, как УПД с незаполненными полями, относящимися к первичному документу.

Чтобы визуализация счета-фактуры была привычной, при отправке документа необходимо указывать тип в API Invoice.

Соответствие типов документов
-----------------------------

.. csv-table:: Соответствие типов документов
   :header: "Веб", "API", "Форматы", "Функция", "Печатная форма"
   :widths: 10, 10, 10, 10, 10

   "Счет-фактура", "Invoice", "- приказ №93;

   - приказ №155", "СЧФ", "Счет-фактура"
   "Акт", "XmlAcceptanceCertificate", "- приказ №172;

   - приказ №155", "ДОП", "Акт"
   "Накладная", "XmlTorg12", "- приказ №172;

   - приказ №155", "ДОП", "Накаладная"
   "УПД", "UniversalTransferDocument", "- приказ №155", "- СЧФ,
   - ДОП,
   - СЧФДОП", "УПД"


Определение формата
-------------------

В связи с тем, что документ может быть в разных форматах – интеграционным решениям необходимо понимать в каком формате пришел документ, что бы корректно обработать его на своей стороне.

Для получения акутальной информации о XSD-схеме документа введено специальное поле *AttachmentVersion*.

Оно появилось в структурах данных :doc:`Document <proto/Document>`, :doc:`Entity <proto/Entity message>` и :doc:`DocumentInfo <proto/DocumentInfo>`.

Типы документов и их версии
---------------------------

Возможные значения *AttachmentVersion*:

.. csv-table:: Типы и версии для формализованных документов
   :header: "Тип документы", "Структура", "Возможные версии"
   :widths: 10, 10, 10

   "Счет-фактура (СФ)", "Invoice", "- invoice_05_01_01;
   - invoice_05_01_03;
   - invoice_05_02_01;
   - utd_05_01_01;
   - utd_05_01_02"
   "Исправление СФ", "InvoiceRevision", "- invoice_05_01_03;
   - invoice_05_02_01;
   - utd_05_01_01;
   - utd_05_01_02"
   "Корректировочный СФ (КСФ)", "InvoiceCorrection", "- invoicecor_05_01_03;
   - invoicecor_05_02_01;
   - ucd_05_01_01"
   "Исправление КСФ", "InvoiceCorrectionRevision", "- invoicecor_05_01_03;
   - invoicecor_05_02_01;
   - ucd_05_01_01"
   "Формализованный ТОРГ-12", "XmlTorg12", "- torg12_05_01_01;
   - torg12_05_01_02;
   - utd_05_01_01"
   "Формализованный акт", "XmlAcceptanceCertificate", "- act_05_01_01;
   - act_05_01_02;
   - utd_05_01_01"
   "УПД", "UniversalTransferDocument", "- utd_05_01_01;
   - utd_05_01_02"
   "Исправление УПД", "UniversalTransferDocumentRevision", "- utd_05_01_01;
   - utd_05_01_02"
   "УКД", "UniversalCorrectionDocument", "- ucd_05_01_01"
   "Исправление УКД", "UniversalCorrectionDocumentRevision", "- ucd_05_01_01"

.. csv-table:: Типы и версии для неформализованных документов
    :header: "Тип документы", "Структура", "Возможные версии"
    :widths: 10, 10, 10

    "Неформализованный документ", "Nonformalized", "v1"
    "Приглашение к ЭДО", "TrustConnectionRequest", "v1"
    "Неформализованный ТОРГ-12", "Torg12", "v1"
    "Неформализованный акт", "AcceptanceCertificate", "v1"
    "Счет", "ProformaInvoice", "v1"
    "Ценовой лист", "PriceList", "v1"
    "Протокол согласования цены", "PriceListAgreement", "v1"
    "Реестр сертификатов", "CertificateRegistry", "v1"
    "Акт сверки", "ReconciliationAct", "v1"
    "Договор", "Contract", "v1"
    "Накладная", "Torg13", "v1"
    "Детализация", "ServiceDetails", "v1"
    "Доп. соглашение", "SupplementaryAgreement", "v1"
    "Уведомление МЭС", "MesNotification", "v1"
